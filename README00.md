# Тема: Разработка программного обеспечения для конроллера велогибрида с поддержкой СМЕ
## Контекст
Имеется велосипед с прицепом. На прицепе перевозят грузы (иногда очень много грузов всяких тяжёлых).

Представим, как надо с горой кирпичей в прицепе за спиной подняться в гору. Обычное колесо велосипеда будет проскальзывать или если и не будет проскальзывать, то он (мотор) должен быть очень мощным (ну о-о-очень мощным), чтобы поднять всё это в гору в одиночку.

Ещё представим, как надо с этой же горой кирпичей обратно с горы спуститься. Спуск обещал быть быстрым, но внезапно появилась яма. После резкой попытки резко затормозить, прицеп со своей инерцией обогнал велосипед и всё попадало.

Из всего этого можно сделать следующую гипотезу:
> Контроль колёс велосипеда и прицепа позволяет сохронять контроль над всей системой

Если установить контроллер на велосипед и прицеп и соединить их в одну сеть, то получится сохранять контроль в подобных ситуациях.
## Общие положения
Данная программа является распределённой системой при условии, что в систему подключены велосипед и прицеп. Каждый контроллер имеет несколько программных модулей для расчёта и связью с аппаратной частью.

Каждый контроллер содержит следующие модули:
- Главный модуль "Шина"
- Модуль-интерфейс с пользователем
- Модуль для работы с мотором
- Модуль для работы с торомозной системой
- Модуль для работы со светотехникой (поворотниками)
- Модуль для расчёта усилия на мотор
- Модуль связи с внешним миром (UART)

## Глоссарий
- Контроллер - электронное устройство, предназначенное для автоматического управления техническим объектом (процессом) по заданному алгоритму.
- Система многих единиц (СМЕ) - способ управления подвижным составом, при котором в один поезд (систему) сцепляется несколько локомотивов или моторных вагонов (единиц), а управление тяговыми двигателями ведётся с одного поста управления и одной локомотивной бригадой.
- UART - узел вычислительных устройств, предназначенный для организации связи с другими цифровыми устройствами.

## Требования
### Функциональные требования:
- система должна включаться и выключаться при необходимости;
- система должна предоставлять возможность подключать дополнительные (ведомые) единицы;
- система должна обрабатывать события отключения и подключения дополнительных единиц;
- система должна отправлять целевые значения скорости и торможения на дополнительные единицы;
- система на дополнительных единицах должна принимать целевые значения скорости и торможения от ведущей единицы;
- система должна иметь возможность встраиваться в существующий электровелосипед;
- система должна иметь возможность встраиваться в существующий прицеп;
- система должна управлять мотором велосипеда;
- система должна управлять мотором прицепа;
- система должна управлять тормозами прицепа;
- система должна выводить пользователю следующую информацию: скорость транспорта, остаток заряда в батарее.

### Перечень нефункциональных требований:
- система должна стоить меньше или равно 10 кредитов (требование дешевезны системы);
- система должна сохранять полный или частичный контроль над транспортом при поломке - непроизвольном отключении системы в прицепе (требование отказоустойчивости);
- отклик в нагрузке на двигатель или на усилие тормозной системы на изменение управляющего сигнала не должен превышать 0,1 секунду (требование быстродействия).

## Модель предметной области
![Диаграмма вариантов использования](./Resourses/Диаграма%20вариантов%20использования.png)
![Диаграмма компонентов](./Resourses/C4%20-%20компонент.png)
![Диаграмма последовательности](./Resourses/Диаграмма%20последовательности.png)

## Инструментарий
- Платформа (микроконтроллер): `STM32`
- Язык: `С++`
- IDE: `STM32Cube IDE`
- Линтер: `clang`

## Модель данных
В виду того, что данном проекте БД так таковой нет, вместо неё в оперативной памяти есть специальная структура "Состояние", в котором содержится информация о состоянии системы, как понятно из названия. Вместо описания БД, я сделаю описание этой структуры.

| Название переменной  | Описание | Тип данных |
| -------------------- | ------------- | ------------- |
| Speed  | Показатель скорости  | `uint16_t` |
| Brake  | Показатель тормозного усилия  | `uint16_t` |
| LeftLight  | Показатель работы левого поворотника  | `boolean` |
| RightLight  | Показатель работы правого поворотника  | `boolean` |

## MVP
В рамках первой лабораторной работы представлены две программы, которые симулируют работу протокола общения между двумя контроллерами. Приходящие сообщения выводятся на консоль на сайте, который предоставляет MVP.

P.S. В качестве первого прототипа выла выбрана нецелевая платформа STM32, а ESP32, как система, позволяющая работать с web-интерфейсом. В дальнейшем эта система будет использоваться в качестве тестов и отладки основной системы.

### Требуемая аппаратура
- Flipper zero
- WiFi-модуль на базе ESP32 для Flipper zero

### Порядок работы
1. Загрузить скетч в WiFi-модуль
2. Закинуть файл "uart.js" в папку "scripts" в Flipper zero
3. Подсоеденить WiFi-модуль к Flipper zero
4. Запустить скрипт "uart.js"
5. Подключится к сети "ESP32"
6. Открыть сайт "192.168.0.1" в браузере
